<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krema't Kape - Order History</title>
    <link rel="stylesheet" href="styles.css">
    <script src="auth.js"></script>
    <style>
        .order-history-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(75, 56, 50, 0.8);
            padding: 30px;
            border-radius: 10px;
            color: #fff;
        }

        .history-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #c9a66b;
            padding-bottom: 20px;
        }

        .history-header h2 {
            color: #c9a66b;
            margin: 0 0 10px 0;
        }

        .empty-orders {
            text-align: center;
            padding: 40px 20px;
            color: #ccc;
        }

        .empty-orders h3 {
            color: #c9a66b;
            margin-bottom: 20px;
        }

        .empty-orders a {
            background-color: #c9a66b;
            color: #000;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            display: inline-block;
            margin-top: 20px;
        }

        .empty-orders a:hover {
            background-color: #fff;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .order-card {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #c9a66b;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .order-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .order-card-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .order-card-header div {
            display: flex;
            flex-direction: column;
        }

        .order-card-header strong {
            color: #c9a66b;
            margin-bottom: 3px;
        }

        .order-card-header span {
            color: #ccc;
            font-size: 0.9em;
        }

        .order-card-body {
            border-top: 1px solid #555;
            padding-top: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .order-items-preview {
            color: #ccc;
            font-size: 0.9em;
        }

        .order-items-preview strong {
            color: #c9a66b;
        }

        .order-total {
            text-align: right;
        }

        .order-total strong {
            color: #c9a66b;
            font-size: 1.1em;
        }

        .view-order-btn {
            background-color: #c9a66b;
            color: #000;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-left: auto;
        }

        .view-order-btn:hover {
            background-color: #fff;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-badge.order-placed {
            background-color: #4caf50;
            color: white;
        }

        .status-badge.picked-up {
            background-color: #2196f3;
            color: white;
        }

        .status-badge.to-ship {
            background-color: #ff9800;
            color: white;
        }

        .status-badge.shipped {
            background-color: #9c27b0;
            color: white;
        }

        .status-badge.delivered {
            background-color: #4caf50;
            color: white;
        }

        .back-btn {
            background-color: #555;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background-color: #777;
        }

        @media (max-width: 768px) {
            .order-card-header {
                grid-template-columns: 1fr;
            }

            .order-card-body {
                grid-template-columns: 1fr;
            }

            .view-order-btn {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="MENU.html">Our Menu</a>
        <a href="ContactUs.html">Contact</a>
        <div>
            <a href="SignUp.html">Sign Up</a>
            <a href="LogIn.html">Log In</a>
            <a href="Cart.html">üõí</a>
        </div>
    </nav>

    <div class="container">
        <div class="content">
            <div class="order-history-container">
                <div class="history-header">
                    <h2>Your Order History</h2>
                    <p style="color: #ccc; margin: 10px 0 0 0;">View and track your orders</p>
                </div>

                <a href="Cart.html" class="back-btn">‚Üê Back to Cart</a>

                <div id="orders-content">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Krema't Kape Shop. All rights reserved.</p>
    </footer>

    <script>
        function getStatusBadgeClass(status) {
            const statusMap = {
                'Order Placed': 'order-placed',
                'Picked Up': 'picked-up',
                'To Ship': 'to-ship',
                'Shipped': 'shipped',
                'Out for Delivery': 'shipped',
                'Delivered': 'delivered'
            };
            return statusMap[status] || 'order-placed';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function loadOrderHistory() {
            const orders = JSON.parse(localStorage.getItem('krematakape_orders')) || [];
            const ordersContent = document.getElementById('orders-content');

            if (orders.length === 0) {
                ordersContent.innerHTML = `
                    <div class="empty-orders">
                        <h3>No Orders Yet</h3>
                        <p>You haven't placed any orders yet. Start shopping now!</p>
                        <a href="MENU.html">Browse Menu</a>
                    </div>
                `;
                return;
            }

            // Sort orders by date (newest first)
            orders.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));

            let html = '<div class="orders-list">';

            for (const order of orders) {
                const itemsPreview = order.items.slice(0, 2).map(item => `${item.title} x${item.quantity}`).join(', ');
                const moreItems = order.items.length > 2 ? ` +${order.items.length - 2} more` : '';
                const badgeClass = getStatusBadgeClass(order.status);

                html += `
                    <div class="order-card" onclick="viewOrder('${order.id}')">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <span class="status-badge ${badgeClass}">${order.status}</span>
                            </div>
                            <button class="view-order-btn" onclick="viewOrder('${order.id}'); event.stopPropagation();">View Details</button>
                        </div>
                        <div class="order-card-header">
                            <div>
                                <strong>Order #${order.id.replace('ORD-', '')}</strong>
                                <span>${formatDate(order.orderDate)}</span>
                            </div>
                            <div>
                                <strong>Items</strong>
                                <span>${order.items.length} item${order.items.length > 1 ? 's' : ''}</span>
                            </div>
                            <div>
                                <strong>Total</strong>
                                <span>‚Ç±${order.total.toFixed(2)}</span>
                            </div>
                        </div>
                        <div class="order-card-body">
                            <div class="order-items-preview">
                                <strong>Items:</strong> ${itemsPreview}${moreItems}
                            </div>
                            <div class="order-total">
                                <strong>‚Ç±${order.total.toFixed(2)}</strong>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            ordersContent.innerHTML = html;
        }

        function viewOrder(orderId) {
            location.href = 'OrderTracking.html?orderId=' + orderId;
        }

        loadOrderHistory();
    </script>
</body>
</html>
